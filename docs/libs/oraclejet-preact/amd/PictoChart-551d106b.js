define(['exports', 'preact/jsx-runtime', './UNSAFE_PictoChart/themes/PictoChartStyles.css', './classNames-2e65b3b3', './Common/themes/themeContract.css', './utils-8a58b095', './SvgSymbol-4ab30c6f', 'preact', 'preact/hooks', './size-a13c8931', './useUser-e0989b0b', './useSelection-0c4c6e5c', './useTranslationBundle-d999fb18', './mergeProps-7d608009', './LayoutUtils-75d8cff4', './useDatatip-88cbd577', './util-aa688832', './useItemFocus-8a9e9050', './useTestId-af48c25c', './TrackResizeContainer-ff49e9cb'], (function(t,e,o,n,r,i,a,s,c,l,d,u,f,m,p,h,I,g,C,b){"use strict";const x=s.createContext({});function S(t){const e=t.dataset.idx;if(void 0!==e)return{idx:Number(e)}}function v(t,e,o,n,r,i,a,s,c){let l=!1;if(!n){const t=!!a&&e===a.idx,o=!!r&&e===r.idx;l=!!(t&&a?.isCurrent||o&&r?.isCurrent)}const d=function(t,e){return!e||0===e.length||new Set(e).has(t)}(t.id,s),u=function(t,e){return!(!e||0===e.length)&&new Set(e).has(t)}(t.id,i);return{isCurrent:l,isHighlighted:d,isSelected:u,hasSelection:i&&0!==i.length,isFocused:!!a&&y(a,e),key:t.id,itemIdx:e,countIdx:o,activeId:l?c:void 0,isReadOnly:n,item:t}}function w(t,e){return t?.idx===e?.idx}function y(t,e){return!!t.isFocusVisible&&t.idx===e}function R(t,e,o){return`${o?.dataVisualization_labelCountWithTotal({itemCount:t.toString(),totalCount:e.toString()})}`}const P=({context:t,markerProps:o})=>{const{supportsSelection:n}=c.useContext(x),s=function(t,e,o,n,a,s){const c="human"===t,l=o||a&&s,d="ellipse"===t||"rectangle"===t,u=n?i.rgb(r.colorSchemeVars.palette.neutral[130]):l?e:void 0;return{markerShape:t,tx:c?70:void 0,ty:c?60:void 0,markerColor:e,borderColor:n||l?i.rgb(r.colorSchemeVars.palette.neutral[0]):e,outerBorderColor:u,markerScale:d&&!u?1:.85,setAspectRatioNone:!!d}}(o.shape,o.color,t.state.focused,t.state.selected,t.state.hovered,n);return e.jsx(a.SvgSymbol,{...s})};const k=t=>{const r=t.supportsSelection||t.supportsAction,{dimmedItemStyle:i,interactiveItemStyle:a}=o.styles,s=n.classNames([r&&a,!t.isHighlighted&&i]),c=0===t.countIdx,l=c&&function(t,e,o,n,r,i,a,s,c){const l=o||a?i?r?.dataVisualization_stateSelected():r?.dataVisualization_stateUnselected():"",d=r?R(t,e,r):"";return{"aria-label":[s||`${n?n+": ":""}${d}`,l].filter(Boolean).join(". ")||void 0,role:"img",id:c}}(t.item.count||1,t.totalCount,!!t.supportsSelection,t.item.label,t.translations,t.isSelected,t.hasSelection,t.item.accessibleLabel,t.activeId)||{};return e.jsx("div",{ref:c?t.focusedItemRef:void 0,id:t.activeId,"data-idx":t.itemIdx,"data-count-idx":t.countIdx,style:{gridRow:`${t.row+1} / span ${t.item.rowSpan||1}`,gridColumn:`${t.column+1} / span ${t.item.columnSpan||1}`},class:s,...l,children:t.children})},M=.25;function F(t,e){return Math.ceil(t/e)*e}const T=t=>"bottomStart"===t||"bottomEnd"===t,$=(t,e)=>{const o="topEnd"===t||"bottomEnd"===t;return e?!o:o},A=(t,e,o,n,r)=>{for(let i=0;i<r;i++)for(let r=0;r<n;r++)if(t[o+i][e+r])return!1;return!0},U=(t,e,o,n,r)=>{for(let i=0;i<r;i++)for(let r=0;r<n;r++)t[o+i][e+r]=!0},j=(t,e,o,n,r,i)=>{if(i){const i=j(t,o,e,r,n,!1);return i?{col:i.row,row:i.col}:void 0}for(let i=0;i<r-o+1;i++)for(let r=0;r<n-e+1;r++)if(A(t,r,i,e,o))return U(t,r,i,e,o),{col:r,row:i}};function D(t,e){const{idx:o}=t;return e[o]}function V(t){return{getItem:e=>D(e,t),getDetailFromInfo:e=>{if(!e)return{id:void 0};const o=D(e,t);return{id:o?o.id:void 0}},getPrevItemInfo:t=>function(t){let e=t.idx;return e=Math.max(0,e-1),{idx:e}}(t),getNextItemInfo:e=>function(t,e){let o=t.idx;return o=Math.min(e.length-1,o+1),{idx:o}}(e,t)}}function E(t,e,o,n,r,i){const[a,s]=c.useState({idx:0}),[l,u]=c.useState(),f=c.useRef(),{direction:m}=d.useUser(),h="rtl"===m,I=t=>{t.preventDefault(),t.stopPropagation()},g=o=>{const n=S(o.target);w(n,l)||(u(n&&{...n,isCurrent:!0}),f.current=p.getRandomId(),t&&(s({...a,isCurrent:!1}),i?.(e(n))))},C=()=>{u(void 0),f.current=void 0,t&&i?.(e())};if(!t)return{focusedItemInfo:a,hoveredItemInfo:l,onPointerLeave:C,onPointerMove:g};function b(t){i?.(e(t)),f.current=p.getRandomId(),s(t)}function x(t){w(t,a)||(t.isCurrent=!0,t.isFocusVisible=!0,l&&u({...l,isCurrent:!1}),b(t))}return{focusedItemInfo:a,hoveredItemInfo:l,"aria-activedescendant":f.current,onPointerUp:t=>{const o=S(t.target);if(null!=o){s(o);const{id:t}=e(o);null!=t&&(r?.({id:t}),f.current=p.getRandomId())}else r?.({id:void 0})},onPointerMove:g,onKeyUp:t=>{switch(t.code){case"Enter":(()=>{const{id:t}=e(a);null!=t&&(r?.({id:t}),f.current=p.getRandomId())})(),I(t);break;case"Tab":b({...a,isCurrent:!0,isFocusVisible:!0}),I(t)}},onKeyDown:t=>{switch(t.key){case"Tab":return;case"ArrowDown":x(n(a)),I(t);break;case"ArrowUp":x(o(a)),I(t);break;case"ArrowRight":x(h?o(a):n(a)),I(t);break;case"ArrowLeft":x(h?n(a):o(a)),I(t);break}},onPointerLeave:C,onBlur:()=>{(null!=l||a.isCurrent)&&i?.(e(void 0));const t={...a,isCurrent:!1,isFocusVisible:!1};s(t)}}}t.PictoChart=function({width:t,height:a,columnWidth:s,rowHeight:c,items:p,columnCount:w,rowCount:y,layout:P,layoutOrigin:A="topStart",selectionMode:U="none",highlightedIds:D=[],hiddenIds:z=[],selectedIds:N=[],onItemAction:L,onItemInput:B,...H}){const _=0!==p.length,q=p.filter((t=>!z?.includes(t.id))),W=function(t){let e=0;for(let o=0;o<t.length;o++)e+=t[o].count||1;return e}(q),O=f.useTranslationBundle("@oracle/oraclejet-preact"),G=!(!U||"none"===U),K=null!=L,Z=!G&&!K&&null===B,{direction:J}=d.useUser(),Q=C.useTestId(H.testId),{getItem:X,getDetailFromInfo:Y,getPrevItemInfo:tt,getNextItemInfo:et}=V(q),{hoveredItemInfo:ot,focusedItemInfo:nt,...rt}=E(!Z&&_,Y,tt,et,L,B),it=u.useSelection({idExtracter:t=>{const e="keyup"===t.type?nt:S(t.target);return Y(e).id},isDrillEnabled:null!=L,selection:N,selectionMode:U,onChange:H.onSelectionChange}),at=s&&parseFloat(s),st=c&&parseFloat(c),ct=n.classNames([o.baseStyles]),{focusedItemRef:lt}=g.useItemFocus(nt),{content:dt,borderColor:ut}=function(t,e,o,n,a,s,c){let l;const d=a?.isCurrent;let u,f;d&&null!=t[a.idx].id&&(l=a),n&&n.isCurrent&&(l=n);let m=i.rgb(r.colorSchemeVars.palette.neutral[0]);const p=l&&e(l,t);if(p&&s){const t=p&&{data:p},{content:e,borderColor:n}=s(t);u=e,m=n||m,f=c?R(p.count||1,o,c):""}return{borderColor:m,content:u||l&&e(l,t)?.accessibleLabel||l&&e(l,t)?.label+": "+f||f}}(q,X,W,nt,ot,H.datatip,O),ft=void 0===t,mt=void 0===a;return e.jsx(x.Provider,{value:{supportsSelection:G},children:e.jsx(b.TrackResizeContainer,{width:ft?"initial":!ft&&l.sizeToCSS(t)||"0px",height:mt?"initial":!mt&&l.sizeToCSS(a)||"0px",children:function(t,n){const{calcColCount:r,calcRowCount:i,calcColWidth:a,calcRowHeight:s,gridGap:c}=function(t,e,n,r,i,a,s,c,l,d){let u=0,f=1,m=1,p=1/0;for(let e=0;e<t.length;e++){const o=t[e],n=o.columnSpan||1,r=o.rowSpan||1;n<=0||r<=0||(n>f&&(f=n),r>m&&(m=r),n<p&&(p=n),r<p&&(p=r),u+=n*r*(o.count||1))}if(0===u)return{};(i||a)&&(l||(l=d||o.DEFAULT_SIZE),d||(d=l)),s||c||(i||a?i?a?e?c=F(Math.sqrt(u),m):s=F(Math.sqrt(u),f):c=Math.max(Math.floor(r/(d||1)),1):s=Math.max(Math.floor(n/(l||1)),1):e?c=F(Math.sqrt(u*r/n),m):s=F(Math.sqrt(u*n/r),f)),s?c||(c=F(u/s,m)):s=F(u/(c||1),f);const h=M*p;return i||a||(l||(l=d||Math.min(n/s,r/(c||1))),d||(d=l)),s<=0||!c||c<=0||!l||l<=0||!d||d<=0?{}:{calcColCount:s,calcRowCount:c,calcColWidth:l?l-h:l,calcRowHeight:d?d-h:d,gridGap:h}}(p,"vertical"===P,t,n,ft,mt,w,y,at,st),{datatipContent:l,datatipProps:u}=(({content:t,borderColor:e,width:o,focusedItemRef:n,focusedItemInfo:r})=>{const{direction:i}=d.useUser(),a="rtl"===i,s=n.current?.getBoundingClientRect(),{datatipContent:c,datatipProps:l}=h.useDatatip({content:t,placement:"top-start",anchor:r?.isCurrent?"element":"pointer",offset:I.calculateOffset(a,o,r.isCurrent?s:void 0),borderColor:e});return{datatipContent:c,datatipProps:l}})({content:dt,width:t,borderColor:ut,focusedItemRef:lt,focusedItemInfo:nt});if(!r)return null;const f=function(t,e,o,n,r,i){const a=e,s=o,c=T(n),l=$(n,i),d=[],u=new Array(a);for(let t=0;t<a;t++)u[t]=new Array(s).fill(!1);for(let e=0;e<t.length;e++){const o=t[e];let n=0;const i=o.rowSpan??1,f=o.columnSpan??1,m=o.count??1;for(;n<m;){const t=j(u,f,i,s,a,r);void 0!==t&&d.push({row:c?a-t.row-i:t.row,col:l?s-t.col-f:t.col,countIdx:n,itemIdx:e,item:o}),n+=1}}return d}(q,i,r,A,"vertical"===P,"rtl"===J),g=m.mergeProps(rt,u,it);return e.jsxs("div",{tabIndex:0,"aria-label":H["aria-label"],"aria-describedby":H["aria-describedby"],"aria-labelledby":H["aria-labelledby"],role:"application",style:{width:ft?"max-content":`${t}px`,height:mt?"max-content":`${n}px`,gridTemplateRows:`repeat(${i}, ${s}px)`,gridTemplateColumns:`repeat(${r}, ${a}px)`,gap:`${c}px`},class:ct,...Q,...g,children:[f.map((t=>{const o=nt.idx===t.itemIdx,n=v(t.item,t.itemIdx,t.countIdx,Z,ot,N,nt,D,rt["aria-activedescendant"]),r={data:t.item,state:{selected:n.isSelected,focused:n.isFocused,hovered:n.isCurrent}};return e.jsx(k,{focusedItemRef:o?lt:void 0,row:t.row,column:t.col,supportsSelection:G,supportsAction:K,translations:O,totalCount:W,...n,children:H.children(r)})})),l]})}})})},t.getPictoDefaultRenderers=function(t){return{markerRenderer:o=>{const n=t(o.data);return e.jsx(P,{context:o,markerProps:n})},datatipRenderer:e=>({borderColor:t(e.data).color})}}}));
//# sourceMappingURL=PictoChart-551d106b.js.map
